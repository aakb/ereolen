(function(e){function t(t,r){if(e.trim(t.text()).length<=r.condensedLength+r.minTrail)return o("element too short: skipping."),!1;var i=e.trim(t.html()),s=e.trim(t.text()),u=r.delim,a=t.clone(),f=0;do{var l=n(i,r.delim,r.condensedLength+f);a.html(e.trim(i.substring(0,l+1)));var c=a.text().length,h=a.html().length;f=a.html().length-c,o("condensing... [html-length:"+h+" text-length:"+c+" delta: "+f+" break-point: "+l+"]")}while(a.text().length<r.condensedLength);return s.length-c<r.minTrail?(o("not enough trailing text: skipping."),!1):(o("clone condensed. [text-length:"+c+"]"),a)}function n(e,t,n){var i=!1,s=n;do{var s=e.indexOf(t,s);if(s<0)return o("No delimiter found."),e.length;i=!0;while(r(e,s))s++,i=!1}while(!i);return o("Delimiter found in html at: "+s),s}function r(e,t){return e.indexOf(">",t)<e.indexOf("<",t)}function i(e,t){o("Condense Trigger: "+e.html());var n=e.parent(),r=n.next();r.show();var i=r.width(),s=r.height();r.hide();var u=n.width(),a=n.height();n.animate({height:s,width:i,opacity:1},t.lessSpeed,t.easing,function(){n.height(a).width(u).hide(),r.show()})}function s(e,t){o("Expand Trigger: "+e.html());var n=e.parent(),r=n.prev();t.expandedWidth&&r.width(t.expandedWidth),r.show();var i=r.width(),s=r.height();r.width(n.width()+"px").height(n.height()+"px"),n.hide(),r.animate({height:s,width:i,opacity:1},t.moreSpeed,t.easing);if(n.attr("id")){var u=n.attr("id");n.attr("id","condensed_"+u),r.attr("id",u)}}function o(e){window.console&&window.console.log&&window.console.log(e)}e.fn.condense=function(n){e.metadata?o("metadata plugin detected"):o("metadata plugin not present");var r=e.extend({},e.fn.condense.defaults,n);return this.each(function(){$this=e(this);var n=e.metadata?e.extend({},r,$this.metadata()):r;o("Condensing ["+$this.text().length+"]: "+$this.text());var u=t($this,n);if(u){$this.attr("id")?$this.attr("id","condensed_"+$this.attr("id")):!1;var a=" <span class='condense_control condense_control_more' style='cursor:pointer;'>"+n.moreText+"</span>",f=" <span class='condense_control condense_control_less' style='cursor:pointer;'>"+n.lessText+"</span>";u.append(n.ellipsis+a),$this.after(u).hide().append(f),e(".condense_control_more",u).click(function(){o("moreControl clicked."),s(e(this),n)}),e(".condense_control_less",$this).click(function(){o("lessControl clicked."),i(e(this),n)})}})},e.fn.condense.defaults={condensedLength:200,minTrail:20,delim:" ",moreText:"[more]",lessText:"[less]",ellipsis:" ( ... )",moreSpeed:"normal",lessSpeed:"normal",easing:"linear"}})(jQuery)